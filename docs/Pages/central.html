<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Governance Dashboard | MoSJE/DBT Mission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = { darkMode: 'class' }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transition: all 0.2s ease-in-out;
        }
        .card:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -2px rgb(0 0 0 / 0.1); }
        .dark .card { background-color: #1c1b1a; border: 1px solid #374151; box-shadow: none; }
        .dark .card:hover { background-color: #2c2b2a; }
        .modal-root { transition: opacity 0.3s ease; }
        .modal-container { transition: transform 0.3s ease, opacity 0.3s ease; }
        .clickable-item, .table-row-clickable { cursor: pointer; transition: background-color 0.2s; }
        .clickable-item:hover, .table-row-clickable:hover { background-color: #f7f7f7; }
        .dark .clickable-item:hover, .dark .table-row-clickable:hover { background-color: #2c2b2a; }
        #marriageIncentiveChart, #stateDelayChart { cursor: pointer; }
    </style>
</head>
<body class="flex min-h-screen bg-[#fdfaf6] dark:bg-black">
    <!-- Sidebar -->
    <aside class="sidebar w-64 flex-shrink-0 border-r border-slate-200 dark:border-gray-700 flex flex-col dark:bg-[#1c1b1a]">
        <div class="p-6">
            <h1 class="text-2xl font-bold text-slate-800 dark:text-gray-100 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9M3 12h18M3 12a9 9 0 019-9m-9 9a9 9 0 009 9" /></svg>
                DBT Mission
            </h1>
        </div>
        <nav class="flex-1 px-4 py-2">
            <a href="central.html" class="flex items-center px-4 py-2.5 text-slate-700 bg-indigo-50 dark:bg-gray-700 dark:text-gray-100 rounded-lg font-semibold"><i data-lucide="layout-dashboard" class="w-5 h-5 mr-3 text-indigo-600 dark:text-indigo-400"></i>Dashboard</a>
            <a href="reports.html" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="bar-chart-3" class="w-5 h-5 mr-3"></i>Reports</a>
            <a href="projects-alert.html" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="shield-alert" class="w-5 h-5 mr-3"></i>Alerts</a>
            <a href="beneficiaries.html" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="users" class="w-5 h-5 mr-3"></i>Beneficiaries</a>
            <a href="#" class="flex items-center px-4 py-2.5 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-1 font-medium"><i data-lucide="settings" class="w-5 h-5 mr-3"></i>Settings</a>
        </nav>
        <div class="p-4 mt-auto">
            <a href="#" class="flex items-center px-4 py-4 text-slate-600 dark:text-gray-400 hover:bg-slate-100 dark:hover:bg-gray-700 rounded-lg mt-4 font-medium"><i data-lucide="log-out" class="w-5 h-5 mr-3"></i>Sign Out</a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-6 lg:p-8 overflow-y-auto">
        <!-- Header -->
        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8">
            <div>
                <h2 class="text-3xl font-bold text-slate-800 dark:text-gray-100">National Governance Dashboard</h2>
                <p class="text-slate-500 dark:text-gray-400 mt-1">MoSJE/DBT Mission | National Impact, Policy Monitoring, and Trend Analysis</p>
            </div>
            <div class="flex items-center mt-4 sm:mt-0">
                <div class="flex items-center space-x-2">
                    <button class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700 relative"><i data-lucide="bell" class="w-5 h-5 text-slate-600 dark:text-gray-400"></i><span class="absolute top-1 right-1.5 block h-2 w-2 rounded-full bg-red-500 ring-2 ring-white dark:ring-black"></span></button>
                    <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-gray-700"><i data-lucide="sun" id="theme-toggle-light-icon" class="w-5 h-5 text-slate-600 dark:text-gray-400"></i><i data-lucide="moon" id="theme-toggle-dark-icon" class="w-5 h-5 text-slate-600 dark:text-gray-400 hidden"></i></button>
                </div>
                <div class="flex items-center ml-4"><img src="https://placehold.co/40x40/E2E8F0/475569?text=AS" alt="User" class="w-10 h-10 rounded-full"><div class="ml-3"><p class="font-semibold text-slate-800 dark:text-gray-100">Dr. Ananya Sharma</p><p class="text-sm text-slate-500 dark:text-gray-400">Joint Secretary, MoSJE</p></div></div>
            </div>
        </div>

        <!-- KPI Cards -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="card p-5 md:col-span-1 lg:col-span-1 flex flex-col items-center justify-center text-center"><h3 class="text-slate-500 dark:text-gray-400 font-medium">DBT National Impact Score</h3><div class="relative mt-2"><canvas id="impactScoreChart" class="w-32 h-32"></canvas><div class="absolute inset-0 flex items-center justify-center"><span class="text-4xl font-bold text-indigo-600 dark:text-indigo-400">88</span></div></div><p class="text-sm text-green-600 flex items-center mt-2"><i data-lucide="arrow-up" class="w-4 h-4 mr-1"></i><span>2.5 pts</span> <span class="text-slate-500 dark:text-gray-400 ml-1">vs last week</span></p></div>
            <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Total Relief Disbursed</h3><div class="p-2 bg-green-100 dark:bg-green-500/10 rounded-md"><i data-lucide="landmark" class="w-5 h-5 text-green-600 dark:text-green-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">₹1,250 Cr</p><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Nationwide YTD</p></div>
            <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Beneficiaries Covered</h3><div class="p-2 bg-blue-100 dark:bg-blue-500/10 rounded-md"><i data-lucide="users" class="w-5 h-5 text-blue-600 dark:text-blue-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">2.8 M</p><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">Across all states</p></div>
            <div class="card p-5"><div class="flex justify-between items-start"><h3 class="text-slate-500 dark:text-gray-400 font-medium">Avg. Time-to-Disbursement</h3><div class="p-2 bg-yellow-100 dark:bg-yellow-500/10 rounded-md"><i data-lucide="timer" class="w-5 h-5 text-yellow-600 dark:text-yellow-400"></i></div></div><p class="text-4xl font-bold text-slate-800 dark:text-gray-100 mt-2">18 Days</p><p class="text-sm text-slate-500 dark:text-gray-400 mt-1">National average</p></div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6 mt-6">
            <div class="card lg:col-span-3 p-5"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100">Inter-Scheme Atrocity Correlation</h3><div class="flex items-center space-x-4 text-sm"><span class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span><span class="text-slate-600 dark:text-gray-400">Atrocities</span></span><span class="flex items-center"><span class="w-3 h-3 rounded-full bg-indigo-500 mr-2"></span><span class="text-slate-600 dark:text-gray-400">Relief Claims</span></span></div></div><div style="height: 300px;"><canvas id="atrocityCorrelationChart"></canvas></div></div>
            <div class="card lg:col-span-2 p-5"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100">State-Level Delay Metrics</h3><button id="view-all-delays-btn" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300">View All <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i></button></div><p class="text-sm text-slate-500 dark:text-gray-400 mb-4">Top 5 states by average disbursement delay (days).</p><div style="height: 260px;"><canvas id="stateDelayChart"></canvas></div></div>
        </div>

        <!-- Trackers & Alerts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
            <div class="card p-5"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100">Inter-Caste Marriage Incentive Tracker</h3><button id="view-all-states-btn" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300">View All <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i></button></div><p class="text-sm text-slate-500 dark:text-gray-400 mb-4">Top 5 states by incentives disbursed this year.</p><div style="height: 320px;"><canvas id="marriageIncentiveChart"></canvas></div></div>
            <div class="card p-5 flex flex-col"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-semibold text-slate-800 dark:text-gray-100">Security & Anomaly Alerts</h3><button id="view-log-btn" class="flex items-center text-sm font-medium text-indigo-600 hover:text-indigo-800 dark:text-indigo-400 dark:hover:text-indigo-300">View Log <i data-lucide="arrow-right" class="w-4 h-4 ml-1"></i></button></div><div id="alerts-container" class="space-y-3 flex-1"></div></div>
        </div>
    </main>

    <!-- Modals -->
    <div id="state-delay-modal" class="modal-root fixed inset-0 z-50 flex items-center justify-center hidden opacity-0"><div class="modal-overlay absolute inset-0 bg-black/50"></div><div class="modal-container relative bg-white dark:bg-[#1c1b1a] rounded-lg shadow-xl w-full max-w-4xl m-4 transform scale-95 opacity-0"><div class="flex items-center justify-between p-4 border-b dark:border-gray-700 rounded-t-lg bg-red-600"><h3 id="state-delay-modal-title" class="text-xl font-semibold text-white"></h3><button class="close-modal-btn text-gray-200 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6"><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 text-center"><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Average Delay</p><p id="delay-modal-avg" class="text-2xl font-bold text-red-500"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Total Cases</p><p id="delay-modal-cases" class="text-2xl font-bold text-slate-800 dark:text-gray-100"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Pending Sanction</p><p id="delay-modal-sanction" class="text-2xl font-bold text-slate-800 dark:text-gray-100"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Pending Disbursement</p><p id="delay-modal-disbursement" class="text-2xl font-bold text-slate-800 dark:text-gray-100"></p></div></div><div class="grid grid-cols-1 md:grid-cols-3 gap-6"><div class="md:col-span-2"><h4 class="font-semibold text-slate-800 dark:text-gray-100 mb-2">Monthly Delay Trend (Avg. Days)</h4><div style="height: 200px;"><canvas id="state-delay-trend-chart"></canvas></div></div><div><h4 class="font-semibold text-slate-800 dark:text-gray-100 mb-2">Delay Bottleneck</h4><div style="height: 200px;"><canvas id="delay-bottleneck-chart"></canvas></div></div></div></div></div></div>
    <div id="all-delays-modal" class="modal-root fixed inset-0 z-50 flex items-center justify-center hidden opacity-0"><div class="modal-overlay absolute inset-0 bg-black/50"></div><div class="modal-container relative bg-white dark:bg-[#1c1b1a] rounded-lg shadow-xl w-full max-w-5xl m-4 flex flex-col transform scale-95 opacity-0" style="max-height: 90vh;"><div class="flex items-center justify-between p-4 border-b dark:border-gray-700 sticky top-0 bg-white dark:bg-[#1c1b1a]"><h3 class="text-xl font-semibold text-slate-800 dark:text-gray-100">All States Delay Metrics</h3><button class="close-modal-btn text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6 overflow-y-auto"><table class="w-full text-left text-sm"><thead class="text-xs text-slate-500 dark:text-gray-400 uppercase bg-slate-50 dark:bg-gray-800"><tr><th class="px-6 py-3">State</th><th class="px-6 py-3">Avg. Delay (Days)</th><th class="px-6 py-3">Total Cases</th><th class="px-6 py-3">Pending Sanction</th><th class="px-6 py-3">Pending Disbursement</th></tr></thead><tbody id="all-delays-table-body"></tbody></table></div></div></div>
    <div id="state-detail-modal" class="modal-root fixed inset-0 z-50 flex items-center justify-center hidden opacity-0"><div class="modal-overlay absolute inset-0 bg-black/50"></div><div class="modal-container relative bg-white dark:bg-[#1c1b1a] rounded-lg shadow-xl w-full max-w-3xl m-4 transform scale-95 opacity-0"><div class="flex items-center justify-between p-4 border-b dark:border-gray-700 rounded-t-lg bg-indigo-600"><h3 id="state-modal-title" class="text-xl font-semibold text-white"></h3><button class="close-modal-btn text-gray-200 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6"><div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 text-center"><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Incentives Disbursed</p><p id="state-modal-disbursed" class="text-2xl font-bold text-slate-800 dark:text-gray-100"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Couples Benefited</p><p id="state-modal-couples" class="text-2xl font-bold text-slate-800 dark:text-gray-100"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="text-sm font-medium text-slate-500 dark:text-gray-500">Applications Pending</p><p id="state-modal-pending" class="text-2xl font-bold text-slate-800 dark:text-gray-100"></p></div></div><div><h4 class="font-semibold text-slate-800 dark:text-gray-100 mb-2">Monthly Uptake Trend</h4><div style="height: 200px;"><canvas id="state-trend-chart"></canvas></div></div></div></div></div>
    <div id="all-states-modal" class="modal-root fixed inset-0 z-50 flex items-center justify-center hidden opacity-0"><div class="modal-overlay absolute inset-0 bg-black/50"></div><div class="modal-container relative bg-white dark:bg-[#1c1b1a] rounded-lg shadow-xl w-full max-w-5xl m-4 flex flex-col transform scale-95 opacity-0" style="max-height: 90vh;"><div class="flex items-center justify-between p-4 border-b dark:border-gray-700 sticky top-0 bg-white dark:bg-[#1c1b1a]"><h3 class="text-xl font-semibold text-slate-800 dark:text-gray-100">All States Incentive Data</h3><button class="close-modal-btn text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6 overflow-y-auto"><table class="w-full text-left text-sm"><thead class="text-xs text-slate-500 dark:text-gray-400 uppercase bg-slate-50 dark:bg-gray-800"><tr><th class="px-6 py-3">State</th><th class="px-6 py-3">Incentives (Lakhs)</th><th class="px-6 py-3">Couples Benefited</th><th class="px-6 py-3">Pending</th><th class="px-6 py-3">Avg. Time (Days)</th></tr></thead><tbody id="all-states-table-body"></tbody></table></div></div></div>
    <div id="alert-detail-modal" class="modal-root fixed inset-0 z-50 flex items-center justify-center hidden opacity-0"><div class="modal-overlay absolute inset-0 bg-black/50"></div><div class="modal-container relative bg-white dark:bg-[#1c1b1a] rounded-lg shadow-xl w-full max-w-2xl m-4 transform scale-95 opacity-0"><div id="alert-modal-header" class="flex items-center justify-between p-4 border-b dark:border-gray-700 rounded-t-lg"><h3 id="alert-modal-title" class="text-xl font-semibold text-white"></h3><button class="close-modal-btn text-gray-200 hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6 space-y-4"><div><h4 class="font-semibold text-slate-800 dark:text-gray-100">Description</h4><p id="alert-modal-description" class="text-slate-600 dark:text-gray-400"></p></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="font-medium text-slate-500 dark:text-gray-500">Timestamp</p><p id="alert-modal-timestamp" class="font-semibold text-slate-700 dark:text-gray-300"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="font-medium text-slate-500 dark:text-gray-500">Severity</p><p id="alert-modal-severity" class="font-semibold"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="font-medium text-slate-500 dark:text-gray-500">User Account</p><p id="alert-modal-user" class="font-semibold text-slate-700 dark:text-gray-300"></p></div><div class="bg-slate-50 dark:bg-gray-800 p-3 rounded-lg"><p class="font-medium text-slate-500 dark:text-gray-500">Source IP</p><p id="alert-modal-ip" class="font-semibold text-slate-700 dark:text-gray-300"></p></div></div><div><h4 class="font-semibold text-slate-800 dark:text-gray-100">Recommended Action</h4><p id="alert-modal-action" class="text-slate-600 dark:text-gray-400"></p></div></div><div class="flex items-center justify-end p-4 space-x-2 border-t dark:border-gray-700 rounded-b-lg"><button class="close-modal-btn bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700">Acknowledge</button><button class="close-modal-btn bg-slate-200 dark:bg-gray-600 text-slate-800 dark:text-gray-200 font-semibold py-2 px-4 rounded-lg hover:bg-slate-300 dark:hover:bg-gray-500">Close</button></div></div></div>
    <div id="all-alerts-modal" class="modal-root fixed inset-0 z-50 flex items-center justify-center hidden opacity-0"><div class="modal-overlay absolute inset-0 bg-black/50"></div><div class="modal-container relative bg-white dark:bg-[#1c1b1a] rounded-lg shadow-xl w-full max-w-6xl m-4 flex flex-col transform scale-95 opacity-0" style="max-height: 90vh;"><div class="flex items-center justify-between p-4 border-b dark:border-gray-700 sticky top-0 bg-white dark:bg-[#1c1b1a]"><h3 class="text-xl font-semibold text-slate-800 dark:text-gray-100">Full Security Log</h3><button class="close-modal-btn text-gray-500 dark:text-gray-400 hover:text-gray-800 dark:hover:text-white"><i data-lucide="x" class="w-6 h-6"></i></button></div><div class="p-6 overflow-y-auto"><div class="overflow-x-auto"><table class="w-full text-left text-sm"><thead class="text-xs text-slate-500 dark:text-gray-400 uppercase bg-slate-50 dark:bg-gray-800"><tr><th class="px-6 py-3">Timestamp</th><th class="px-6 py-3">Severity</th><th class="px-6 py-3">Alert Type</th><th class="px-6 py-3">Details</th><th class="px-6 py-3">User</th><th class="px-6 py-3">Status</th></tr></thead><tbody id="all-alerts-table-body"></tbody></table></div></div></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // --- GLOBAL STATE ---
        const appState = {
            charts: {},
            modalCharts: {},
            isDark: false
        };

        // --- DATA SOURCES (mock data) ---
        const alertsData = [
            { id: 1, severity: 'Critical', type: 'High-Risk Login Failure', title: 'Multiple failed login attempts from a blacklisted IP on the Admin Portal.', user: 'N/A', ip: '203.0.113.55', timestamp: new Date(Date.now() - 2 * 36e5).toISOString(), status: 'New', action: 'The source IP has been temporarily blocked. Investigate logs for potential breach attempts. Ensure multi-factor authentication is enforced for all admin accounts.' },
            { id: 2, severity: 'High', type: 'Anomalous Disbursement', title: 'A disbursement of ₹5,00,000 was approved, exceeding the 99th percentile.', user: 'state_fin_bihar', ip: '203.0.113.112', timestamp: new Date(Date.now() - 8 * 36e5).toISOString(), status: 'New', action: 'The transaction has been automatically paused pending manual review. Verify the legitimacy of the claim and the approval.' },
            { id: 3, severity: 'High', type: 'Suspicious Bulk Upload', title: "User 'state_admin_up' initiated an upload of 15,000+ beneficiary records.", user: 'state_admin_up', ip: '198.51.100.2', timestamp: new Date(Date.now() - 25 * 36e5).toISOString(), status: 'New', action: 'Review the uploaded data for integrity. Confirm with the user from Uttar Pradesh if this action was legitimate. Monitor the account for further unusual activity.' },
            { id: 4, severity: 'Medium', type: 'Data Integrity Flag', title: '25 records in Maharashtra flagged for potential duplicate Aadhaar numbers.', user: 'system_daemon', ip: '127.0.0.1', timestamp: new Date(Date.now() - 3 * 864e5).toISOString(), status: 'Acknowledged', action: 'A report has been generated for the state-level authority in Maharashtra to verify and correct the flagged records. No immediate security action required.' },
            { id: 5, severity: 'Medium', type: 'Masked Data Access Attempt', title: "User 'dist_admin_pune' attempted to export unmasked beneficiary contact details.", user: 'dist_admin_pune', ip: '192.0.2.14', timestamp: new Date(Date.now() - 4 * 864e5).toISOString(), status: 'Acknowledged', action: 'Access was denied by policy. An automated warning has been sent to the user regarding data privacy protocols.' },
            { id: 6, severity: 'High', type: 'Unusual Login Location', title: "Login detected for 'national_auditor' from a new country.", user: 'national_auditor', ip: '104.244.42.1', timestamp: new Date(Date.now() - 5 * 864e5).toISOString(), status: 'New', action: 'Session has been flagged for monitoring. If suspicious, terminate the session and force a password reset.' },
            { id: 7, severity: 'Medium', type: 'Rapid Data Deletion', title: "User 'temp_contractor_del' deleted over 500 records in under 5 minutes.", user: 'temp_contractor_del', ip: '198.51.100.88', timestamp: new Date(Date.now() - 6 * 864e5).toISOString(), status: 'New', action: 'The user account has been temporarily suspended. Review the deleted records from backup and investigate the user\'s activity.' },
            { id: 8, severity: 'Critical', type: 'SQL Injection Attempt', title: 'Potential SQL injection pattern detected in API search parameter.', user: 'Anonymous', ip: '45.55.12.34', timestamp: new Date(Date.now() - 7 * 864e5).toISOString(), status: 'Blocked', action: 'The request was blocked by the firewall. The source IP has been added to a high-risk watchlist. Review firewall rules for robustness.' },
            { id: 9, severity: 'Medium', type: 'Data Integrity Flag', title: 'Spike in applications from a single district in West Bengal.', user: 'system_daemon', ip: '127.0.0.1', timestamp: new Date(Date.now() - 8 * 864e5).toISOString(), status: 'New', action: 'Flagged for pattern analysis. May indicate organized fraud. Inform the state nodal officer for on-ground verification.' },
            { id: 10, severity: 'High', type: 'Privilege Escalation Attempt', title: "User 'dist_admin_jaipur' attempted to access national-level settings.", user: 'dist_admin_jaipur', ip: '192.0.2.144', timestamp: new Date(Date.now() - 9 * 864e5).toISOString(), status: 'Blocked', action: 'Access was denied. The user\'s role permissions have been logged for audit. This may indicate a compromised account.' },
            { id: 11, severity: 'Medium', type: 'Repeated Large Reports', title: "User 'report_user_tn' generated the All-India Disbursement report 10 times in one hour.", user: 'report_user_tn', ip: '198.51.100.210', timestamp: new Date(Date.now() - 10 * 864e5).toISOString(), status: 'Acknowledged', action: 'User notified about system resource usage. Monitor for signs of data exfiltration.' },
            { id: 12, severity: 'Medium', type: 'Data Integrity Flag', title: '15 new bank accounts added from a single IP address in a short period.', user: 'system_daemon', ip: '127.0.0.1', timestamp: new Date(Date.now() - 11 * 864e5).toISOString(), status: 'New', action: 'Flagged transactions associated with these accounts for additional verification before disbursement.' },
            { id: 13, severity: 'Critical', type: 'Admin Account Sharing', title: "Concurrent logins for 'super_admin' from geographically distinct IPs.", user: 'super_admin', ip: 'Multiple', timestamp: new Date(Date.now() - 12 * 864e5).toISOString(), status: 'New', action: 'All active sessions for this user have been terminated. A mandatory password reset is required. This is a critical violation of security policy.' },
            { id: 14, severity: 'High', type: 'Anomalous Disbursement', title: 'Batch of 50 disbursements approved outside of normal business hours (3 AM).', user: 'state_auto_approve', ip: '127.0.0.1', timestamp: new Date(Date.now() - 13 * 864e5).toISOString(), status: 'New', action: 'The batch has been held for manual review. Investigate the approval process and associated user account.' },
            { id: 15, severity: 'Medium', type: 'Masked Data Access Attempt', title: 'Multiple attempts to view full Aadhaar numbers by a junior clerk account.', user: 'clerk_patna_04', ip: '203.0.113.201', timestamp: new Date(Date.now() - 14 * 864e5).toISOString(), status: 'Blocked', action: 'Access was denied. The user\'s manager has been notified. Further attempts will result in account suspension.' }
        ];
        const stateIncentiveData = [{stateName:'Maharashtra',incentivesDisbursed:1250,couplesBenefited:500,applicationsPending:120,avgProcessingTime:45,uptakeTrend:[60,65,75,80,95,105]},{stateName:'Karnataka',incentivesDisbursed:1100,couplesBenefited:440,applicationsPending:90,avgProcessingTime:42,uptakeTrend:[55,60,70,72,85,95]},{stateName:'Tamil Nadu',incentivesDisbursed:980,couplesBenefited:392,applicationsPending:75,avgProcessingTime:38,uptakeTrend:[50,55,60,68,78,85]},{stateName:'Kerala',incentivesDisbursed:850,couplesBenefited:340,applicationsPending:60,avgProcessingTime:35,uptakeTrend:[45,50,58,62,70,75]},{stateName:'Haryana',incentivesDisbursed:760,couplesBenefited:304,applicationsPending:55,avgProcessingTime:50,uptakeTrend:[40,42,48,55,60,65]},{stateName:'Andhra Pradesh',incentivesDisbursed:720,couplesBenefited:288,applicationsPending:80,avgProcessingTime:52,uptakeTrend:[35,40,45,50,58,62]},{stateName:'Arunachal Pradesh',incentivesDisbursed:50,couplesBenefited:20,applicationsPending:5,avgProcessingTime:65,uptakeTrend:[2,3,3,4,4,5]},{stateName:'Assam',incentivesDisbursed:150,couplesBenefited:60,applicationsPending:25,avgProcessingTime:70,uptakeTrend:[5,7,8,10,12,15]},{stateName:'Bihar',incentivesDisbursed:450,couplesBenefited:180,applicationsPending:150,avgProcessingTime:90,uptakeTrend:[15,18,20,25,30,32]},{stateName:'Chhattisgarh',incentivesDisbursed:300,couplesBenefited:120,applicationsPending:40,avgProcessingTime:60,uptakeTrend:[10,12,15,18,22,25]},{stateName:'Goa',incentivesDisbursed:80,couplesBenefited:32,applicationsPending:10,avgProcessingTime:40,uptakeTrend:[3,4,5,5,6,7]},{stateName:'Gujarat',incentivesDisbursed:650,couplesBenefited:260,applicationsPending:70,avgProcessingTime:48,uptakeTrend:[30,35,40,48,52,58]},{stateName:'Himachal Pradesh',incentivesDisbursed:120,couplesBenefited:48,applicationsPending:15,avgProcessingTime:55,uptakeTrend:[5,6,7,8,10,12]},{stateName:'Jharkhand',incentivesDisbursed:250,couplesBenefited:100,applicationsPending:60,avgProcessingTime:85,uptakeTrend:[8,10,12,15,18,20]},{stateName:'Madhya Pradesh',incentivesDisbursed:550,couplesBenefited:220,applicationsPending:110,avgProcessingTime:75,uptakeTrend:[25,28,32,38,45,50]},{stateName:'Manipur',incentivesDisbursed:40,couplesBenefited:16,applicationsPending:8,avgProcessingTime:68,uptakeTrend:[1,2,2,3,4,4]},{stateName:'Meghalaya',incentivesDisbursed:30,couplesBenefited:12,applicationsPending:6,avgProcessingTime:66,uptakeTrend:[1,1,2,2,3,3]},{stateName:'Mizoram',incentivesDisbursed:25,couplesBenefited:10,applicationsPending:4,avgProcessingTime:64,uptakeTrend:[1,1,1,2,2,3]},{stateName:'Nagaland',incentivesDisbursed:20,couplesBenefited:8,applicationsPending:3,avgProcessingTime:72,uptakeTrend:[1,1,1,1,2,2]},{stateName:'Odisha',incentivesDisbursed:350,couplesBenefited:140,applicationsPending:85,avgProcessingTime:88,uptakeTrend:[12,15,18,20,25,28]},{stateName:'Punjab',incentivesDisbursed:400,couplesBenefited:160,applicationsPending:50,avgProcessingTime:58,uptakeTrend:[18,20,25,28,32,35]},{stateName:'Rajasthan',incentivesDisbursed:600,couplesBenefited:240,applicationsPending:95,avgProcessingTime:62,uptakeTrend:[28,32,38,42,48,52]},{stateName:'Sikkim',incentivesDisbursed:15,couplesBenefited:6,applicationsPending:2,avgProcessingTime:50,uptakeTrend:[1,1,1,1,1,2]},{stateName:'Telangana',incentivesDisbursed:680,couplesBenefited:272,applicationsPending:78,avgProcessingTime:46,uptakeTrend:[32,38,42,48,55,60]},{stateName:'Tripura',incentivesDisbursed:60,couplesBenefited:24,applicationsPending:12,avgProcessingTime:75,uptakeTrend:[2,3,4,4,5,6]},{stateName:'Uttar Pradesh',incentivesDisbursed:800,couplesBenefited:320,applicationsPending:200,avgProcessingTime:95,uptakeTrend:[35,40,45,50,60,65]},{stateName:'Uttarakhand',incentivesDisbursed:100,couplesBenefited:40,applicationsPending:20,avgProcessingTime:60,uptakeTrend:[4,5,6,7,8,10]},{stateName:'West Bengal',incentivesDisbursed:480,couplesBenefited:192,applicationsPending:90,avgProcessingTime:80,uptakeTrend:[20,22,28,32,38,42]}];
        const stateDelayData = [{stateName:"Uttar Pradesh",averageDelay:95,totalCases:12500,pendingSanction:800,pendingDisbursement:1200,delayTrend:[90,92,95,98,96,95],bottleneck:{state:40,district:60}},{stateName:"Bihar",averageDelay:92,totalCases:9800,pendingSanction:750,pendingDisbursement:1100,delayTrend:[88,90,94,95,93,92],bottleneck:{state:45,district:55}},{stateName:"Odisha",averageDelay:88,totalCases:7500,pendingSanction:600,pendingDisbursement:900,delayTrend:[85,86,88,90,89,88],bottleneck:{state:50,district:50}},{stateName:"Jharkhand",averageDelay:85,totalCases:6200,pendingSanction:550,pendingDisbursement:800,delayTrend:[82,84,85,87,86,85],bottleneck:{state:55,district:45}},{stateName:"West Bengal",averageDelay:82,totalCases:8800,pendingSanction:700,pendingDisbursement:1000,delayTrend:[80,81,82,84,83,82],bottleneck:{state:60,district:40}},{stateName:"Madhya Pradesh",averageDelay:78,totalCases:10500,pendingSanction:900,pendingDisbursement:1300,delayTrend:[75,76,78,80,79,78],bottleneck:{state:35,district:65}},{stateName:"Assam",averageDelay:75,totalCases:4500,pendingSanction:400,pendingDisbursement:600,delayTrend:[72,74,75,77,76,75],bottleneck:{state:65,district:35}},{stateName:"Rajasthan",averageDelay:65,totalCases:9500,pendingSanction:850,pendingDisbursement:1150,delayTrend:[62,64,65,67,66,65],bottleneck:{state:30,district:70}},{stateName:"Chhattisgarh",averageDelay:62,totalCases:5800,pendingSanction:500,pendingDisbursement:750,delayTrend:[60,61,62,64,63,62],bottleneck:{state:40,district:60}},{stateName:"Gujarat",averageDelay:50,totalCases:7200,pendingSanction:650,pendingDisbursement:950,delayTrend:[48,49,50,52,51,50],bottleneck:{state:25,district:75}},{stateName:"Maharashtra",averageDelay:48,totalCases:15500,pendingSanction:1200,pendingDisbursement:1800,delayTrend:[45,46,48,50,49,48],bottleneck:{state:20,district:80}},{stateName:"Karnataka",averageDelay:45,totalCases:11500,pendingSanction:1000,pendingDisbursement:1500,delayTrend:[42,44,45,47,46,45],bottleneck:{state:22,district:78}},{stateName:"Andhra Pradesh",averageDelay:55,totalCases:8500,pendingSanction:700,pendingDisbursement:1000,delayTrend:[52,54,55,57,56,55],bottleneck:{state:33,district:67}},{stateName:"Telangana",averageDelay:46,totalCases:7800,pendingSanction:600,pendingDisbursement:900,delayTrend:[44,45,46,48,47,46],bottleneck:{state:28,district:72}},{stateName:"Tamil Nadu",averageDelay:40,totalCases:13500,pendingSanction:1100,pendingDisbursement:1600,delayTrend:[38,39,40,42,41,40],bottleneck:{state:18,district:82}},{stateName:"Kerala",averageDelay:38,totalCases:9200,pendingSanction:800,pendingDisbursement:1200,delayTrend:[36,37,38,40,39,38],bottleneck:{state:15,district:85}},{stateName:"Punjab",averageDelay:58,totalCases:6500,pendingSanction:550,pendingDisbursement:850,delayTrend:[56,57,58,60,59,58],bottleneck:{state:42,district:58}},{stateName:"Haryana",averageDelay:52,totalCases:5500,pendingSanction:450,pendingDisbursement:700,delayTrend:[50,51,52,54,53,52],bottleneck:{state:38,district:62}},{stateName:"Uttarakhand",averageDelay:60,totalCases:3200,pendingSanction:300,pendingDisbursement:450,delayTrend:[58,59,60,62,61,60],bottleneck:{state:48,district:52}},{stateName:"Himachal Pradesh",averageDelay:56,totalCases:2800,pendingSanction:250,pendingDisbursement:400,delayTrend:[54,55,56,58,57,56],bottleneck:{state:52,district:48}},{stateName:"Goa",averageDelay:42,totalCases:1200,pendingSanction:100,pendingDisbursement:150,delayTrend:[40,41,42,44,43,42],bottleneck:{state:25,district:75}},{stateName:"Sikkim",averageDelay:51,totalCases:500,pendingSanction:50,pendingDisbursement:80,delayTrend:[49,50,51,53,52,51],bottleneck:{state:55,district:45}},{stateName:"Arunachal Pradesh",averageDelay:68,totalCases:800,pendingSanction:80,pendingDisbursement:120,delayTrend:[66,67,68,70,69,68],bottleneck:{state:70,district:30}},{stateName:"Nagaland",averageDelay:74,totalCases:600,pendingSanction:60,pendingDisbursement:100,delayTrend:[72,73,74,76,75,74],bottleneck:{state:75,district:25}},{stateName:"Manipur",averageDelay:72,totalCases:900,pendingSanction:90,pendingDisbursement:130,delayTrend:[70,71,72,74,73,72],bottleneck:{state:72,district:28}},{stateName:"Mizoram",averageDelay:70,totalCases:700,pendingSanction:70,pendingDisbursement:110,delayTrend:[68,69,70,72,71,70],bottleneck:{state:78,district:22}},{stateName:"Tripura",averageDelay:76,totalCases:1500,pendingSanction:150,pendingDisbursement:220,delayTrend:[74,75,76,78,77,76],bottleneck:{state:68,district:32}},{stateName:"Meghalaya",averageDelay:69,totalCases:1100,pendingSanction:110,pendingDisbursement:160,delayTrend:[67,68,69,71,70,69],bottleneck:{state:76,district:24}}];

        // --- CHART & THEME HELPERS ---
        const getChartOptions = (isDark) => { const gridColor = isDark ? 'rgba(255, 255, 255, 0.1)' : '#e2e8f0'; const textColor = isDark ? '#9ca3af' : '#64748b'; return { doughnut: { responsive: true, maintainAspectRatio: false, cutout: '75%', plugins: { legend: { display: false }, tooltip: { enabled: true } } }, bar: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { display: false }, ticks: { color: textColor } } }, plugins: { legend: { display: false } }, interaction: { intersect: false, mode: 'index' } }, line: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: false, grid: { color: gridColor }, ticks: { color: textColor } }, x: { grid: { color: gridColor }, ticks: { color: textColor } } }, plugins: { legend: { display: false } }, interaction: { intersect: false, mode: 'index' }, tension: 0.4 }, horizontalBar: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, scales: { y: { grid: { display: false }, ticks: { color: textColor } }, x: { grid: { color: gridColor }, ticks: { color: textColor } } }, plugins: { legend: { display: false } } } }; };
        const destroyAllCharts = () => { Object.values(appState.charts).forEach(chart => chart?.destroy()); Object.values(appState.modalCharts).forEach(chart => chart?.destroy()); appState.charts = {}; appState.modalCharts = {}; };

        // --- THEME MANAGEMENT ---
        const setTheme = (isDark) => {
            appState.isDark = isDark;
            document.documentElement.classList.toggle('dark', isDark);
            document.getElementById('theme-toggle-light-icon').classList.toggle('hidden', isDark);
            document.getElementById('theme-toggle-dark-icon').classList.toggle('hidden', !isDark);
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            destroyAllCharts();
            createAllCharts();
        };

        // --- MODAL MANAGEMENT ---
        const openModal = (modalEl) => { modalEl.classList.remove('hidden'); setTimeout(() => { modalEl.classList.remove('opacity-0'); modalEl.querySelector('.modal-container').classList.remove('scale-95', 'opacity-0'); }, 10); };
        const closeModal = (modalEl) => { modalEl.classList.add('opacity-0'); modalEl.querySelector('.modal-container').classList.add('scale-95', 'opacity-0'); setTimeout(() => { modalEl.classList.add('hidden'); }, 300); };
        
        // --- CHART CREATION ---
        function createAllCharts() {
            const options = getChartOptions(appState.isDark);
            
            appState.charts.impactScore = new Chart('impactScoreChart', { type: 'doughnut', data: { datasets: [{ data: [88, 12], backgroundColor: [appState.isDark ? '#6366f1' : '#4f46e5', appState.isDark ? '#374151' : '#e2e8f0'], borderWidth: 0, borderRadius: 5 }] }, options: options.doughnut });
            appState.charts.atrocity = new Chart('atrocityCorrelationChart', { type: 'line', data: { labels: ['Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'], datasets: [{ label: 'Atrocities', data: [1200, 1300, 1150, 1400, 1350, 1500, 1450], borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true }, { label: 'Relief Claims', data: [800, 950, 900, 1100, 1050, 1200, 1180], borderColor: '#4f46e5', backgroundColor: 'rgba(79, 70, 229, 0.1)', fill: true }] }, options: options.line });
            
            const top5Incentive = [...stateIncentiveData].sort((a,b) => b.incentivesDisbursed - a.incentivesDisbursed).slice(0, 5);
            appState.charts.marriageIncentive = new Chart('marriageIncentiveChart', { type: 'bar', data: { labels: top5Incentive.map(s => s.stateName), datasets: [{ data: top5Incentive.map(s => s.incentivesDisbursed), backgroundColor: ['#10b981', '#3b82f6', '#8b5cf6', '#f59e0b', '#ec4899'], borderRadius: 4 }] }, options: options.horizontalBar });
            
            const top5Delay = [...stateDelayData].sort((a,b) => b.averageDelay - a.averageDelay).slice(0, 5);
            appState.charts.stateDelay = new Chart('stateDelayChart', { type: 'bar', data: { labels: top5Delay.map(s => s.stateName), datasets: [{ data: top5Delay.map(s => s.averageDelay), backgroundColor: '#ef4444', borderRadius: 4 }] }, options: options.bar });
        }

        // --- FEATURE HANDLERS ---
        function handleStateIncentiveClick(stateName) { const data = stateIncentiveData.find(s => s.stateName === stateName); if (!data) return; document.getElementById('state-modal-title').textContent = `Incentive Details: ${data.stateName}`; document.getElementById('state-modal-disbursed').textContent = `₹${data.incentivesDisbursed} L`; document.getElementById('state-modal-couples').textContent = data.couplesBenefited.toLocaleString('en-IN'); document.getElementById('state-modal-pending').textContent = data.applicationsPending.toLocaleString('en-IN'); const ctxId = 'state-trend-chart'; if (appState.modalCharts[ctxId]) appState.modalCharts[ctxId].destroy(); appState.modalCharts[ctxId] = new Chart(ctxId, { type: 'line', data: { labels: ['May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'], datasets: [{ label: 'Applications', data: data.uptakeTrend, borderColor: '#34d399', backgroundColor: appState.isDark ? 'rgba(52, 211, 153, 0.1)' : 'rgba(52, 211, 153, 0.2)', fill: true }] }, options: getChartOptions(appState.isDark).line }); openModal(document.getElementById('state-detail-modal')); }
        function handleStateDelayClick(stateName) { const data = stateDelayData.find(s => s.stateName === stateName); if (!data) return; document.getElementById('state-delay-modal-title').textContent = `Delay Analysis: ${data.stateName}`; document.getElementById('delay-modal-avg').textContent = `${data.averageDelay} Days`; document.getElementById('delay-modal-cases').textContent = data.totalCases.toLocaleString('en-IN'); document.getElementById('delay-modal-sanction').textContent = data.pendingSanction.toLocaleString('en-IN'); document.getElementById('delay-modal-disbursement').textContent = data.pendingDisbursement.toLocaleString('en-IN'); const trendCtxId = 'state-delay-trend-chart'; if (appState.modalCharts[trendCtxId]) appState.modalCharts[trendCtxId].destroy(); appState.modalCharts[trendCtxId] = new Chart(trendCtxId, { type: 'line', data: { labels: ['May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct'], datasets: [{ label: 'Avg Delay', data: data.delayTrend, borderColor: '#f87171', backgroundColor: appState.isDark ? 'rgba(248, 113, 113, 0.1)' : 'rgba(248, 113, 113, 0.2)', fill: true }] }, options: getChartOptions(appState.isDark).line }); const bottleneckCtxId = 'delay-bottleneck-chart'; if (appState.modalCharts[bottleneckCtxId]) appState.modalCharts[bottleneckCtxId].destroy(); appState.modalCharts[bottleneckCtxId] = new Chart(bottleneckCtxId, { type: 'doughnut', data: { labels: ['State Level', 'District Level'], datasets: [{ data: [data.bottleneck.state, data.bottleneck.district], backgroundColor: ['#fb923c', '#facc15'], borderWidth: 0 }] }, options: { ...getChartOptions(appState.isDark).doughnut, cutout: '60%', plugins: { legend: { display: true, position: 'bottom', labels: { color: appState.isDark ? '#9ca3af' : '#64748b' } } } } }); openModal(document.getElementById('state-delay-modal')); }
        function handleSecurityAlertClick(alertId) { const data = alertsData.find(a => a.id === parseInt(alertId)); if (!data) return; const modal = document.getElementById('alert-detail-modal'); const config = { 'Critical': { header: 'bg-red-600', text: 'text-red-500' }, 'High': { header: 'bg-yellow-600', text: 'text-yellow-500' }, 'Medium': { header: 'bg-blue-600', text: 'text-blue-500' } }[data.severity]; modal.querySelector('#alert-modal-header').className = `flex items-center justify-between p-4 border-b dark:border-gray-700 rounded-t-lg ${config.header}`; modal.querySelector('#alert-modal-title').textContent = `${data.severity}: ${data.type}`; modal.querySelector('#alert-modal-description').textContent = data.title; modal.querySelector('#alert-modal-timestamp').textContent = new Date(data.timestamp).toLocaleString(); const severityEl = modal.querySelector('#alert-modal-severity'); severityEl.textContent = data.severity; severityEl.className = `font-semibold ${config.text}`; modal.querySelector('#alert-modal-user').textContent = data.user; modal.querySelector('#alert-modal-ip').textContent = data.ip; modal.querySelector('#alert-modal-action').textContent = data.action; openModal(modal); }
        function handleViewLogClick() { const modal = document.getElementById('all-alerts-modal'); const tableBody = modal.querySelector('#all-alerts-table-body'); tableBody.innerHTML = ''; alertsData.forEach(alert => { const config = { 'Critical': { bg: 'bg-red-100 dark:bg-red-500/10', text: 'text-red-800 dark:text-red-300' }, 'High': { bg: 'bg-yellow-100 dark:bg-yellow-500/10', text: 'text-yellow-800 dark:text-yellow-300' }, 'Medium': { bg: 'bg-blue-100 dark:bg-blue-500/10', text: 'text-blue-800 dark:text-blue-300' } }[alert.severity]; const row = tableBody.insertRow(); row.className = 'table-row-clickable bg-white dark:bg-[#1c1b1a] border-b dark:border-gray-700'; row.dataset.alertId = alert.id; row.innerHTML = `<td class="px-6 py-4 dark:text-gray-300 whitespace-nowrap">${new Date(alert.timestamp).toLocaleString()}</td><td class="px-6 py-4"><span class="px-2 py-1 text-xs font-semibold rounded-full ${config.bg} ${config.text}">${alert.severity}</span></td><td class="px-6 py-4 font-medium text-slate-900 dark:text-gray-100">${alert.type}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-400 max-w-xs truncate">${alert.title}</td><td class="px-6 py-4 dark:text-gray-300">${alert.user}</td><td class="px-6 py-4"><span class="font-medium ${alert.status === 'New' ? 'text-red-500' : 'text-green-500'}">${alert.status}</span></td>`; }); openModal(modal); }
        function renderAlerts(limit = 4) { const container = document.getElementById('alerts-container'); container.innerHTML = ''; alertsData.slice(0, limit).forEach(alert => { const config = { 'Critical': { i: 'shield-alert', c: 'red' }, 'High': { i: 'upload-cloud', c: 'yellow' }, 'Medium': { i: 'database-zap', c: 'blue' } }[alert.severity] || { i: 'alert-circle', c: 'gray' }; const timeAgo = Math.round((new Date() - new Date(alert.timestamp)) / 36e5); const timeDisplay = timeAgo < 24 ? `${timeAgo}h ago` : `${Math.floor(timeAgo/24)}d ago`; const el = document.createElement('div'); el.className = `clickable-item flex items-start p-3 bg-${config.c}-50 dark:bg-${config.c}-500/10 rounded-lg`; el.dataset.alertId = alert.id; el.innerHTML = `<i data-lucide="${config.i}" class="w-5 h-5 text-${config.c}-500 mt-1 shrink-0"></i><div class="ml-3 overflow-hidden"><p class="font-semibold text-sm text-${config.c}-800 dark:text-${config.c}-300">${alert.type}</p><p class="text-xs text-slate-600 dark:text-gray-400 truncate">${alert.title}</p><p class="text-xs text-slate-500 dark:text-gray-500 mt-1">${timeDisplay}</p></div>`; container.appendChild(el); }); lucide.createIcons(); }

        // --- EVENT BINDING ---
        document.querySelectorAll('.modal-root').forEach(modal => { modal.addEventListener('click', e => { if (e.target.matches('.modal-overlay, .close-modal-btn, .close-modal-btn *')) closeModal(modal); }); });
        document.getElementById('theme-toggle').addEventListener('click', () => setTheme(!document.documentElement.classList.contains('dark')));
        document.getElementById('marriageIncentiveChart').onclick = (e) => { const p = appState.charts.marriageIncentive.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true); if(p.length) handleStateIncentiveClick(appState.charts.marriageIncentive.data.labels[p[0].index]); };
        document.getElementById('stateDelayChart').onclick = (e) => { const p = appState.charts.stateDelay.getElementsAtEventForMode(e, 'nearest', { intersect: true }, true); if(p.length) handleStateDelayClick(appState.charts.stateDelay.data.labels[p[0].index]); };
        document.getElementById('view-all-states-btn').addEventListener('click', () => { const tableBody = document.getElementById('all-states-table-body'); tableBody.innerHTML = ''; [...stateIncentiveData].sort((a,b) => b.incentivesDisbursed - a.incentivesDisbursed).forEach(s => { const row = tableBody.insertRow(); row.className = 'table-row-clickable bg-white dark:bg-[#1c1b1a] border-b dark:border-gray-700'; row.dataset.stateName = s.stateName; row.innerHTML = `<td class="px-6 py-4 font-medium text-slate-900 dark:text-gray-100">${s.stateName}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.incentivesDisbursed.toLocaleString('en-IN')}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.couplesBenefited.toLocaleString('en-IN')}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.applicationsPending.toLocaleString('en-IN')}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.avgProcessingTime}</td>`; }); openModal(document.getElementById('all-states-modal')); });
        document.getElementById('all-states-table-body').addEventListener('click', (e) => { const row = e.target.closest('tr'); if (row?.dataset.stateName) { closeModal(document.getElementById('all-states-modal')); setTimeout(() => handleStateIncentiveClick(row.dataset.stateName), 300); } });
        document.getElementById('view-all-delays-btn').addEventListener('click', () => { const tableBody = document.getElementById('all-delays-table-body'); tableBody.innerHTML = ''; [...stateDelayData].sort((a, b) => b.averageDelay - a.averageDelay).forEach(s => { const row = tableBody.insertRow(); row.className = 'table-row-clickable bg-white dark:bg-[#1c1b1a] border-b dark:border-gray-700'; row.dataset.stateName = s.stateName; row.innerHTML = `<td class="px-6 py-4 font-medium text-slate-900 dark:text-gray-100">${s.stateName}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.averageDelay}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.totalCases.toLocaleString('en-IN')}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.pendingSanction.toLocaleString('en-IN')}</td><td class="px-6 py-4 text-slate-600 dark:text-gray-300">${s.pendingDisbursement.toLocaleString('en-IN')}</td>`; }); openModal(document.getElementById('all-delays-modal')); });
        document.getElementById('all-delays-table-body').addEventListener('click', (e) => { const row = e.target.closest('tr'); if (row?.dataset.stateName) { closeModal(document.getElementById('all-delays-modal')); setTimeout(() => handleStateDelayClick(row.dataset.stateName), 300); } });
        document.getElementById('alerts-container').addEventListener('click', (e) => { const item = e.target.closest('.clickable-item'); if (item) handleSecurityAlertClick(item.dataset.alertId); });
        document.getElementById('view-log-btn').addEventListener('click', handleViewLogClick);
        document.getElementById('all-alerts-table-body').addEventListener('click', (e) => { const row = e.target.closest('tr'); if (row?.dataset.alertId) { closeModal(document.getElementById('all-alerts-modal')); setTimeout(() => handleSecurityAlertClick(row.dataset.alertId), 300); } });
        
        // --- INITIALIZATION ---
        const initialIsDark = localStorage.getItem('theme') === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches);
        setTheme(initialIsDark);
        renderAlerts();
    });
    </script>
</body>
</html>

